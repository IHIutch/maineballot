---
import Container from '#components/container.astro'
import GlobalLayout from '#layouts/global-layout.astro'
import { getReadingTime } from '#utils/get-reading-time'
import { Image } from 'astro:assets'
import { getCollection } from 'astro:content'

export async function getStaticPaths() {
  const allPosts = await getCollection('posts')
  return allPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }))
}

const { post } = Astro.props
const { Content } = await post.render()
---

<GlobalLayout>
  <div class="bg-center bg-no-repeat bg-cover relative">
    <Image
      class="absolute size-full inset-0 object-cover z-10"
      src={post.data.header.overlay_image}
      loading="eager"
      alt=""
      aria-hidden
    />
    <div class="relative z-20 bg-black/50 py-20">
      <div
        class="max-w-7xl mx-auto px-6 [text-shadow:1px_1px_4px_rgba(0,0,0,0.5)]"
      >
        <h1
          class="mb-8 max-w-prose text-5xl font-bold leading-tight text-white"
        >
          {post.data.title}
        </h1>
        <p class="text-white text-2xl max-w-prose mb-8">
          {post.data.excerpt}
        </p>
        <p class="text-white flex items-center gap-2">
          <span class="icon-[fa6-regular--clock] size-4" aria-hidden></span>
          <span>{getReadingTime(post.body)}</span>
        </p>
      </div>
    </div>
  </div>

  <Container class="prose prose-neutral mt-12">
    <Content />
  </Container>
</GlobalLayout>
